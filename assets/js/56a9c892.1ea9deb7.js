"use strict";(self.webpackChunkexperimenter_docs=self.webpackChunkexperimenter_docs||[]).push([[3217],{4137:(e,t,i)=>{i.d(t,{Zo:()=>u,kt:()=>d});var r=i(7294);function n(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function o(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,r)}return i}function a(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?o(Object(i),!0).forEach((function(t){n(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):o(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function s(e,t){if(null==e)return{};var i,r,n=function(e,t){if(null==e)return{};var i,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)i=o[r],t.indexOf(i)>=0||(n[i]=e[i]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)i=o[r],t.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(n[i]=e[i])}return n}var l=r.createContext({}),m=function(e){var t=r.useContext(l),i=t;return e&&(i="function"==typeof e?e(t):a(a({},t),e)),i},u=function(e){var t=m(e.components);return r.createElement(l.Provider,{value:t},e.children)},p="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},h=r.forwardRef((function(e,t){var i=e.components,n=e.mdxType,o=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),p=m(i),h=n,d=p["".concat(l,".").concat(h)]||p[h]||c[h]||o;return i?r.createElement(d,a(a({ref:t},u),{},{components:i})):r.createElement(d,a({ref:t},u))}));function d(e,t){var i=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var o=i.length,a=new Array(o);a[0]=h;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[p]="string"==typeof e?e:n,a[1]=s;for(var m=2;m<o;m++)a[m]=i[m];return r.createElement.apply(null,a)}return r.createElement.apply(null,i)}h.displayName="MDXCreateElement"},2662:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>l,contentTitle:()=>a,default:()=>c,frontMatter:()=>o,metadata:()=>s,toc:()=>m});var r=i(7462),n=(i(7294),i(4137));const o={id:"ios-microsurveys",title:"Microsurvey Feature for iOS",slug:"/messaging/microsurveys/ios"},a=void 0,s={unversionedId:"workflow/implementing/messaging/microsurveys/ios-microsurveys",id:"workflow/implementing/messaging/microsurveys/ios-microsurveys",title:"Microsurvey Feature for iOS",description:"Introduction",source:"@site/docs/workflow/implementing/messaging/microsurveys/ios-mobile-microsurveys.md",sourceDirName:"workflow/implementing/messaging/microsurveys",slug:"/messaging/microsurveys/ios",permalink:"/messaging/microsurveys/ios",draft:!1,editUrl:"https://github.com/mozilla/experimenter-docs/edit/main/docs/workflow/implementing/messaging/microsurveys/ios-mobile-microsurveys.md",tags:[],version:"current",frontMatter:{id:"ios-microsurveys",title:"Microsurvey Feature for iOS",slug:"/messaging/microsurveys/ios"},sidebar:"sidebar",previous:{title:"Limitations",permalink:"/messaging/limitations"},next:{title:"Remote Localization",permalink:"/messaging/remote-localization"}},l={},m=[{value:"Introduction",id:"introduction",level:2},{value:"UI",id:"ui",level:2},{value:"Prompt",id:"prompt",level:3},{value:"Survey (Modal / Bottom Sheet)",id:"survey-modal--bottom-sheet",level:3},{value:"Additional Views",id:"additional-views",level:3},{value:"Survey JSON recipe",id:"survey-json-recipe",level:2},{value:"Customize the prompt",id:"customize-the-prompt",level:3},{value:"Customize the survey (modal / bottom sheet)",id:"customize-the-survey-modal--bottom-sheet",level:3},{value:"microsurveyConfig",id:"microsurveyconfig",level:4},{value:"Triggers",id:"triggers",level:2},{value:"MVP Example Recipe",id:"mvp-example-recipe",level:2}],u={toc:m},p="wrapper";function c(e){let{components:t,...i}=e;return(0,n.kt)(p,(0,r.Z)({},u,i,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h2",{id:"introduction"},"Introduction"),(0,n.kt)("p",null,"This page provides context on the microsurvey feature and a guide to configure the recipes for future microsurveys, specifically on the iOS platform. The microsurvey feature is an extension of the ",(0,n.kt)("a",{parentName:"p",href:"/messaging/mobile-messaging"},"messaging framework"),", and allows us to capture user\u2019s sentiment on any specific app\u2019s features such as the homepage."),(0,n.kt)("p",null,"Note that this page was created during the MVP phase of the microsurvey project."),(0,n.kt)("h2",{id:"ui"},"UI"),(0,n.kt)("p",null,"The microsurvey feature is composed of two main UI components. One is the prompt and one is the actual survey."),(0,n.kt)("h3",{id:"prompt"},"Prompt"),(0,n.kt)("p",null,"The prompt is an invitation to start the survey and it is shown when the triggers are met. The triggers are determined through the mobile messaging infrastructure and should be specified by the Nimbus recipe. For testing, we have created a trigger in which the user will be eligible to receive the survey after visiting the homepage twice."),(0,n.kt)("p",null,"The prompt is shown until the user completes the survey, closes the survey or reaches the maximum number of display specified in the mobile messaging configurations."),(0,n.kt)("img",{src:"/img/messaging/microsurveys/ios-prompt.png",alt:"Prompt view",className:"img-sm"}),(0,n.kt)("br",null),(0,n.kt)("br",null),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"This title of the prompt which can be customized, but also has a fallback string located ",(0,n.kt)("a",{parentName:"li",href:"https://github.com/mozilla-mobile/firefox-ios/blob/f7cd5ff5cbd9e7100c2cb9ae7b7278f3958dfa3f/firefox-ios/Client/Frontend/Strings.swift#L1361"},"here"),"."),(0,n.kt)("li",{parentName:"ol"},"The close button dismisses the survey and it won't be shown again."),(0,n.kt)("li",{parentName:"ol"},"The continue button starts the survey and shows the survey sheet. The button label can be customized, but also has a fallback string located ",(0,n.kt)("a",{parentName:"li",href:"https://github.com/mozilla-mobile/firefox-ios/blob/f7cd5ff5cbd9e7100c2cb9ae7b7278f3958dfa3f/firefox-ios/Client/Frontend/Strings.swift#L1366"},"here"),".")),(0,n.kt)("h3",{id:"survey-modal--bottom-sheet"},"Survey (Modal / Bottom Sheet)"),(0,n.kt)("p",null,"The survey sheet is shown after the user clicks on the button in the prompt. It is a modal that starts at medium detent (50%) on iPhone and large detent (100%) on iPad. The user will be able to view and fill out the survey."),(0,n.kt)("img",{src:"/img/messaging/microsurveys/ios-sheet.png",alt:"Sheet view",className:"img-sm"}),(0,n.kt)("br",null),(0,n.kt)("br",null),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"The sheet grabber allows users to expand or dismiss the sheet. If the user dismisses the sheet by dragging down, this will close the sheet and show the prompt."),(0,n.kt)("li",{parentName:"ol"},"The close button dismisses both the sheet and the prompt."),(0,n.kt)("li",{parentName:"ol"},"The question and options both can be customized. There are fallback options for the options, but the question is required for the microsurvey message to appear. Fallback strings are located ",(0,n.kt)("a",{parentName:"li",href:"https://github.com/mozilla-mobile/firefox-ios/blob/f7cd5ff5cbd9e7100c2cb9ae7b7278f3958dfa3f/firefox-ios/Client/Frontend/Strings.swift#L1420"},"here"),"."),(0,n.kt)("li",{parentName:"ol"},"The submit button will send the survey result via telemetry and is enabled if at least one option is selected."),(0,n.kt)("li",{parentName:"ol"},"The privacy notice navigates the user to open a new tab. The prompt will still be shown unless the user has completed the survey and views the confirmation page.")),(0,n.kt)("h3",{id:"additional-views"},"Additional Views"),(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",{parentName:"tr",align:null},"User Selected Option"),(0,n.kt)("th",{parentName:"tr",align:null},"Confirmation Page"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},(0,n.kt)("img",{src:"/img/messaging/microsurveys/ios-user-selected-option.png",alt:"Sheet view",className:"img-sm"})),(0,n.kt)("td",{parentName:"tr",align:null},(0,n.kt)("img",{src:"/img/messaging/microsurveys/ios-confirmation.png",alt:"Sheet view",className:"img-sm"}))))),(0,n.kt)("h2",{id:"survey-json-recipe"},"Survey JSON recipe"),(0,n.kt)("p",null,"If you are not familiar with the existing ",(0,n.kt)("a",{parentName:"p",href:"/messaging/mobile-messaging"},"messaging framework"),", please take a look here first. The microsurveys are built on top of the already existing framework, with a couple extra fields to configure the survey."),(0,n.kt)("h3",{id:"customize-the-prompt"},"Customize the prompt"),(0,n.kt)("p",null,"On the prompt, you can customize the prompt title by using the same ",(0,n.kt)("inlineCode",{parentName:"p"},"title")," field as a normal message. This can be configured with the Nimbus recipe or set with a pre-landed string id that is in our app bundle, which is already localizable. The button title can also be configured using the same ",(0,n.kt)("inlineCode",{parentName:"p"},"button-label")," field."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "messages": {\n    "homepage-microsurvey-message": {\n    ...\n     "title": "Help us make Firefox better. It only takes a minute.",\n     "button-label": "Continue",\n    ...\n    }\n  }\n}\n\n')),(0,n.kt)("p",null,"If a customizable string is used, then make sure that translations are provided if needed. See more details on ",(0,n.kt)("a",{parentName:"p",href:"/messaging/mobile-messaging#localization-of-messages"},"localization of messages.")),(0,n.kt)("h3",{id:"customize-the-survey-modal--bottom-sheet"},"Customize the survey (modal / bottom sheet)"),(0,n.kt)("p",null,"For the survey, you can control the question, survey options and UTM parameter for the privacy policy link. For the survey question, use the ",(0,n.kt)("inlineCode",{parentName:"p"},"text")," field at the same level as the ",(0,n.kt)("inlineCode",{parentName:"p"},"title")," one, similar to the latter where you can provide either a string or pre landed string id."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "messages": {\n    "homepage-microsurvey-message": {\n    ...\n     "title": "Help us make Firefox better. It only takes a minute.",\n     "button-label": "Continue",\n     "text": "How satisfied are you with your Firefox homepage?"\n    ...\n    }\n  }\n}\n')),(0,n.kt)("h4",{id:"microsurveyconfig"},"microsurveyConfig"),(0,n.kt)("p",null,"To customize the survey options, icon and UTM parameter, we have to add the ",(0,n.kt)("inlineCode",{parentName:"p"},"microsurveyConfig")," field object. For the survey options, there exists a new field called ",(0,n.kt)("inlineCode",{parentName:"p"},"options"),", it\u2019s an array in which each item will represent a possible survey option for the user to select. Currently, the array is composed of type ",(0,n.kt)("inlineCode",{parentName:"p"},"Text"),", which you can read more about our bundle types ",(0,n.kt)("a",{parentName:"p",href:"https://experimenter.info/fml-spec/#bundle-types"},"here"),"."),(0,n.kt)("p",null,"For the icon, add the ",(0,n.kt)("inlineCode",{parentName:"p"},"icon")," field under ",(0,n.kt)("inlineCode",{parentName:"p"},"microsurveyConfig"),". This is related to the asset used next to the survey question. It should change for each survey feature, but it needs to be a valid icon resource id indicated in our app. This field is composed of type ",(0,n.kt)("inlineCode",{parentName:"p"},"Image"),", which you can read more about our bundle types ",(0,n.kt)("a",{parentName:"p",href:"https://experimenter.info/fml-spec/#bundle-types"},"here"),". The list of standard images can be found ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/mozilla-mobile/firefox-ios/blob/main/BrowserKit/Sources/Common/Constants/StandardImageIdentifiers.swift"},"here"),"."),(0,n.kt)("p",null,"For the UTM parameter, add the ",(0,n.kt)("inlineCode",{parentName:"p"},"utm-content")," field. This is related to the utm-content value that we pass in as a query param for our privacy notice. It should change for each survey feature, but it can be any string. Here is an example case:\n",(0,n.kt)("inlineCode",{parentName:"p"},"https://www.mozilla.org/en-US/privacy/firefox/?utm_medium=firefox-mobile&utm_source=modal&utm_campaign=microsurvey&utm_content=homepage")),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "messages": {\n    "homepage-microsurvey-message": {\n      ...\n      "title":"Help us make Firefox better. It only takes a minute.",\n      "button-label":"Continue",\n      "text":"How satisfied are you with your Firefox homepage?",\n      ...\n      "microsurveyConfig": {\n        "utm-content": "homepage",\n        "icon":"homeLarge",\n        "options": [\n            "Very satisfied", \n            "Satisfied",\n            "Neutral", \n            "Dissatisfied"\n            "Very dissatisfied" \n        ]\n      }\n    }\n  }\n}\n\n')),(0,n.kt)("h2",{id:"triggers"},"Triggers"),(0,n.kt)("p",null,"Before targeting any specific feature triggers must be added pre landed on the app or included as part of the JSON recipe."),(0,n.kt)("p",null,"At the moment, there is one trigger landed specifically to target features:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"SECOND_HOMEPAGE_VIEW"),": Indicate a user has viewed the home screen at least twice.")),(0,n.kt)("p",null,"For adding more triggers please consult with the engineering team."),(0,n.kt)("h2",{id:"mvp-example-recipe"},"MVP Example Recipe"),(0,n.kt)("p",null,"Below is a full example for the homepage feature:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "messages": {\n    "homepage-microsurvey-message": {\n      "experiment": "{experiment}",\n      "surface": "microsurvey",\n      "style": "MICROSURVEY",\n      "trigger-if-all": [\n        "SECOND_HOMEPAGE_VIEW"\n      ],\n      "text": "How satisfied are you with your Firefox homepage?",\n      "title": "Microsurvey/Microsurvey.Prompt.TitleLabel.v127",\n      "button-label": "Microsurvey/Microsurvey.Prompt.Button.v127",\n      "microsurveyConfig": {\n        "utm-content": "homepage",\n        "icon": "homeLarge",\n        "answers": [\n          "Microsurvey/Microsurvey.Survey.Options.LikertScaleOption5.v127",\n          "Microsurvey/Microsurvey.Survey.Options.LikertScaleOption4.v127",\n          "Microsurvey/Microsurvey.Survey.Options.LikertScaleOption3.v127",\n          "Microsurvey/Microsurvey.Survey.Options.LikertScaleOption2.v127",\n          "Microsurvey/Microsurvey.Survey.Options.LikertScaleOption1.v127",\n          "Microsurvey/Microsurvey.Survey.Options.LikertScaleOption6.v129"\n        ]\n      }\n    }\n  }\n}\n')))}c.isMDXComponent=!0}}]);